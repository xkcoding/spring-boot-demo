kind: pipeline
type: docker
name: build

steps:
  - name: compile
    image: maven:3.8.6-amazoncorretto-17
    pull: if-not-exists
    volumes:
      - name: mvn_cache
        path: /root/.m2
    commands:
      - mvn clean package -DskipTests -Dmaven.javadoc.skip=true -B -V

  - name: notification-success
    image: yakumioto/drone-serverchan:2.0.0
    settings:
      key:
        from_secret: sc_key
      text: "[CIé€šçŸ¥]-[${DRONE_REPO_NAME}]âœ…"
      desp: "ä»“åº“ï¼š${DRONE_REPO} åˆ†æ”¯ï¼š`${DRONE_COMMIT_BRANCH}`\n\nğŸ’¬ çŠ¶æ€ï¼šç¬¬ **${DRONE_BUILD_NUMBER}** æ¬¡ç¼–è¯‘æˆåŠŸ\n\nğŸŒ è¯¦æƒ…ï¼š[CIåœ°å€](${DRONE_BUILD_LINK})\n\nğŸ“„ å†…å®¹ï¼š[diff](${DRONE_COMMIT_LINK})"
    when:
      status:
        - success

  - name: notification-failure
    image: yakumioto/drone-serverchan:2.0.0
    settings:
      key:
        from_secret: sc_key
      text: "[CIé€šçŸ¥]-[${DRONE_REPO_NAME}]âŒ"
      desp: "ä»“åº“ï¼š${DRONE_REPO} åˆ†æ”¯ï¼š`${DRONE_COMMIT_BRANCH}`\n\nğŸ’¬ çŠ¶æ€ï¼šç¬¬ **${DRONE_BUILD_NUMBER}** æ¬¡ç¼–è¯‘å¤±è´¥\n\nğŸŒ è¯¦æƒ…ï¼š[CIåœ°å€](${DRONE_BUILD_LINK})\n\nğŸ“„ å†…å®¹ï¼š[diff](${DRONE_COMMIT_LINK})"
    when:
      status:
        - failure

trigger:
  event:
    - push

volumes:
  - name: mvn_cache # The name use in this pipeline,
    host:
      path: /root/.m2 # The path be used in the host.
