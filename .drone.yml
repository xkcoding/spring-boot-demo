kind: pipeline
type: docker
name: build

steps:
  - name: compile
    image: maven:3.8.6-amazoncorretto-17
    pull: if-not-exists
    volumes:
      - name: mvn_cache
        path: /root/.m2
    commands:
      - mvn clean package -DskipTests -Dmaven.javadoc.skip=true -B -V

  - name: notification-success
    image: yakumioto/drone-serverchan:2.0.0
    settings:
      key:
        from_secret: sc_key
      text: "[CIé€šçŸ¥]-[${DRONE_REPO_NAME}]âœ…"
      desp: "âš™ ä»“åº“åï¼š${DRONE_REPO}\n\nğŸ’¬ çŠ¶æ€ï¼šç¬¬ **${DRONE_BUILD_NUMBER}** æ¬¡ç¼–è¯‘æˆåŠŸ\n\nğŸ“„ åˆ†æ”¯ï¼š${DRONE_COMMIT_BRANCH}\n\nğŸŒ è¯¦æƒ…ï¼š[CIåœ°å€](${DRONE_BUILD_LINK})\n\nâœ‰ æäº¤å†…å®¹ï¼š${DRONE_COMMIT_MESSAGE}\n\nğŸ”€ æŸ¥çœ‹è¯¦æƒ…ï¼š[DIFFå†…å®¹](${DRONE_COMMIT_LINK})\n\n"
    when:
      status:
        - success

  - name: notification-failure
    image: yakumioto/drone-serverchan:2.0.0
    settings:
      key:
        from_secret: sc_key
      text: "[CIé€šçŸ¥]-[${DRONE_REPO_NAME}]âŒ"
      desp: "âš™ ä»“åº“åï¼š${DRONE_REPO}\n\nğŸ’¬ çŠ¶æ€ï¼šç¬¬ **${DRONE_BUILD_NUMBER}** æ¬¡ç¼–è¯‘å¤±è´¥\n\nğŸ“„ åˆ†æ”¯ï¼š${DRONE_COMMIT_BRANCH}\n\nğŸŒ è¯¦æƒ…ï¼š[CIåœ°å€](${DRONE_BUILD_LINK})\n\nâœ‰ æäº¤å†…å®¹ï¼š${DRONE_COMMIT_MESSAGE}\n\nğŸ”€ æŸ¥çœ‹è¯¦æƒ…ï¼š[DIFFå†…å®¹](${DRONE_COMMIT_LINK})\n\n"
    when:
      status:
        - failure

trigger:
  event:
    - push

volumes:
  - name: mvn_cache # The name use in this pipeline,
    host:
      path: /root/.m2 # The path be used in the host.
